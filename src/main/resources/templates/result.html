<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}">Verdict</title>
    <meta name="description" th:attr="content=${metaDescription}"/>
    <link rel="canonical" th:attr="href=${canonicalUrl}"/>
    <meta property="og:title" th:attr="content=${ogTitle}"/>
    <meta property="og:description" th:attr="content=${ogDescription}"/>
    <meta property="og:url" th:attr="content=${ogUrl}"/>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/verdict.css}">
    <link rel="stylesheet" th:href="@{/css/ads.css}">
</head>
<body>
<div class="container">
    <div id="topAdSlot"><!-- ADSENSE HERE --></div>

    <div class="quick-edit">
        <form th:action="@{/}" method="get" class="quick-edit-form">
            <input type="hidden" name="job" th:value="${job.slug}"/>
            <div class="quick-grid">
                <label class="field">
                    <span>Current salary</span>
                    <input type="number" name="currentSalary" min="30000" max="1000000" step="1000"
                           th:value="${currentSalary}" required/>
                </label>
                <label class="field">
                    <span>Offer salary</span>
                    <input type="number" name="offerSalary" min="30000" max="1000000" step="1000"
                           th:value="${offerSalary}" required/>
                </label>
                <label class="field">
                    <span>Current city</span>
                    <input name="cityA" list="city-options" th:value="${cityA.slug}" required/>
                </label>
                <label class="field">
                    <span>Offer city</span>
                    <input name="cityB" list="city-options" th:value="${cityB.slug}" required/>
                </label>
                <label class="field">
                    <span>Household</span>
                    <select name="householdType" th:value="${householdType}">
                        <option value="SINGLE" th:selected="${householdType.name() == 'SINGLE'}">Single</option>
                        <option value="FAMILY" th:selected="${householdType.name() == 'FAMILY'}">Family</option>
                    </select>
                </label>
                <label class="field">
                    <span>Housing</span>
                    <select name="housingType" th:value="${housingType}">
                        <option value="RENT" th:selected="${housingType.name() == 'RENT'}">Renting</option>
                        <option value="OWN" th:selected="${housingType.name() == 'OWN'}">Own home</option>
                    </select>
                </label>
                <div class="field submit">
                    <button type="submit" class="cta quick">Update verdict</button>
                    <small class="helper">No JS tricks. We send you to the canonical result.</small>
                </div>
            </div>
        </form>
        <datalist id="city-options">
            <option th:each="city : ${cities}" th:value="${city.slug}"
                    th:text="${city.city + ', ' + city.state}"></option>
        </datalist>
    </div>

    <div th:if="${validationMessage}" class="validation-banner">
        <strong>Check your numbers.</strong>
        <span th:text="${validationMessage}">Please enter a realistic salary.</span>
    </div>

    <div th:class="'verdict-banner verdict-' + ${result.verdict.name().toLowerCase().replace('_','-')}">
        <div class="verdict-top">
            <div class="badge">
                <span th:text="${job.title}">Job</span>
                <strong th:text="${#numbers.formatDecimal(result.deltaPercent,1,1)} + '%'">Delta</strong>
            </div>
            <div>
                <p class="eyebrow" th:text="${cityA.city + ', ' + cityA.state} + ' → ' + ${cityB.city + ', ' + cityB.state}">Route</p>
                <h1 th:text="${result.verdict}">GO</h1>
                <p class="verdict-copy" th:text="${result.verdictCopy}">Punchy copy</p>
            </div>
        </div>
        <div class="verdict-metrics">
            <div class="metric-card">
                <p>Residual in <span th:text="${cityA.city}">City A</span></p>
                <strong th:text="${'$' + #numbers.formatDecimal(result.current.residual, 1, 0)}">0</strong>
            </div>
            <div class="metric-card">
                <p>Residual in <span th:text="${cityB.city}">City B</span></p>
                <strong th:text="${'$' + #numbers.formatDecimal(result.offer.residual, 1, 0)}">0</strong>
            </div>
            <div class="metric-card highlight">
                <p>Delta swing</p>
                <strong th:text="${#numbers.formatDecimal(result.deltaPercent,1,1)} + '%'">0%</strong>
            </div>
        </div>
    </div>

    <div class="panel">
        <div class="meta-row">
            <span th:text="'From ' + ${cityA.city} + ', ' + ${cityA.state}"></span>
            <span>→</span>
            <span th:text="'To ' + ${cityB.city} + ', ' + ${cityB.state}"></span>
            <span class="pill" th:text="${householdType == T(com.offerverdict.model.HouseholdType).FAMILY ? 'Family baseline' : 'Single baseline'}"></span>
            <span class="pill" th:text="${housingType == T(com.offerverdict.model.HousingType).OWN ? 'Owning' : 'Renting'}"></span>
        </div>

        <div class="share-row">
            <button type="button" class="ghost-btn" id="shareButton">Share verdict</button>
            <small class="muted">Copy the canonical link or use native share.</small>
        </div>

        <div class="cta-row" th:switch="${result.verdict}">
            <a class="cta" th:case="${T(com.offerverdict.model.Verdict).GO}" href="#moving">Book moving quotes</a>
            <a class="cta" th:case="${T(com.offerverdict.model.Verdict).CONDITIONAL}" href="#moving">Lock in apartment scouting</a>
            <a class="cta secondary" th:case="${T(com.offerverdict.model.Verdict).WARNING}" href="#negotiate">Use this to negotiate</a>
            <a class="cta secondary" th:case="${T(com.offerverdict.model.Verdict).NO_GO}" href="#budgeting">Grab a budgeting reset</a>
        </div>

        <div class="residual-comparison" th:with="maxResidual=${T(java.lang.Math).max(T(java.lang.Math).abs(result.current.residual), T(java.lang.Math).abs(result.offer.residual)) == 0 ? 1 : T(java.lang.Math).max(T(java.lang.Math).abs(result.current.residual), T(java.lang.Math).abs(result.offer.residual))}, winnerIsOffer=${result.offer.residual >= result.current.residual}">
            <div class="section-title">Residual breathing room</div>
            <div class="residual-bars">
                <div class="residual-bar">
                    <div class="bar-label" th:text="${cityA.city} + ' residual'">City A residual</div>
                    <div class="bar-track">
                        <div class="bar-fill"
                             th:classappend="${winnerIsOffer} ? 'lose' : 'win'"
                             style="width:0%"
                             th:attr="data-width=${#numbers.formatDecimal((T(java.lang.Math).abs(result.current.residual) / maxResidual) * 100, 1, 1)}"></div>
                    </div>
                    <div class="bar-value" th:text="${'$' + #numbers.formatDecimal(result.current.residual,1,0)}">0</div>
                </div>
                <div class="residual-bar">
                    <div class="bar-label" th:text="${cityB.city} + ' residual'">City B residual</div>
                    <div class="bar-track">
                        <div class="bar-fill"
                             th:classappend="${winnerIsOffer} ? 'win' : 'lose'"
                             style="width:0%"
                             th:attr="data-width=${#numbers.formatDecimal((T(java.lang.Math).abs(result.offer.residual) / maxResidual) * 100, 1, 1)}"></div>
                    </div>
                    <div class="bar-value" th:text="${'$' + #numbers.formatDecimal(result.offer.residual,1,0)}">0</div>
                </div>
            </div>
            <p class="residual-caption" th:text="${winnerIsOffer ? cityB.city + ' keeps more monthly breathing room.' : cityA.city + ' keeps more monthly breathing room.'}"></p>
        </div>

        <div class="dream-card" th:with="homeYearsA=${result.current.yearsToBuyHouse}, homeYearsB=${result.offer.yearsToBuyHouse}, teslaMonthsA=${result.current.monthsToBuyTesla}, teslaMonthsB=${result.offer.monthsToBuyTesla}">
            <div class="section-title">Time to dream</div>
            <div class="dream-grid">
                <div class="dream-metric" th:classappend="${homeYearsA <= homeYearsB} ? 'win' : ''">
                    <p th:text="${cityA.city} + ' time to buy a home (20% down)'">City A home</p>
                    <strong th:text="${homeYearsA >= 999 ? 'Impossible' : #numbers.formatDecimal(homeYearsA,1,1) + ' years'}"></strong>
                </div>
                <div class="dream-metric" th:classappend="${homeYearsB < homeYearsA} ? 'win' : ''">
                    <p th:text="${cityB.city} + ' time to buy a home (20% down)'">City B home</p>
                    <strong th:text="${homeYearsB >= 999 ? 'Impossible' : #numbers.formatDecimal(homeYearsB,1,1) + ' years'}"></strong>
                </div>
                <div class="dream-metric" th:classappend="${teslaMonthsA <= teslaMonthsB} ? 'win' : ''">
                    <p th:text="${cityA.city} + ' time to buy a Tesla'">City A tesla</p>
                    <strong th:text="${teslaMonthsA >= 999 ? 'Impossible' : #numbers.formatDecimal(teslaMonthsA,1,1) + ' months'}"></strong>
                </div>
                <div class="dream-metric" th:classappend="${teslaMonthsB < teslaMonthsA} ? 'win' : ''">
                    <p th:text="${cityB.city} + ' time to buy a Tesla'">City B tesla</p>
                    <strong th:text="${teslaMonthsB >= 999 ? 'Impossible' : #numbers.formatDecimal(teslaMonthsB,1,1) + ' months'}"></strong>
                </div>
            </div>
        </div>

        <details class="details" open>
            <summary>Details: net monthly, rent, living cost, residual</summary>
            <div class="grid">
                <div>
                    <h3 th:text="${cityA.city} + ' take-home'">City A</h3>
                    <table>
                        <tr><td>Net monthly</td><td th:text="${'$' + #numbers.formatDecimal(result.current.netMonthly, 1, 0)}"></td></tr>
                        <tr><td>Avg rent</td><td th:text="${'$' + #numbers.formatDecimal(result.current.rent, 1, 0)}"></td></tr>
                        <tr><td>Living cost baseline</td><td th:text="${'$' + #numbers.formatDecimal(result.current.livingCost, 1, 0)}"></td></tr>
                        <tfoot><tr><td>Residual</td><td th:text="${'$' + #numbers.formatDecimal(result.current.residual, 1, 0)}"></td></tr></tfoot>
                    </table>
                </div>
                <div>
                    <h3 th:text="${cityB.city} + ' take-home'">City B</h3>
                    <table>
                        <tr><td>Net monthly</td><td th:text="${'$' + #numbers.formatDecimal(result.offer.netMonthly, 1, 0)}"></td></tr>
                        <tr><td>Avg rent</td><td th:text="${'$' + #numbers.formatDecimal(result.offer.rent, 1, 0)}"></td></tr>
                        <tr><td>Living cost baseline</td><td th:text="${'$' + #numbers.formatDecimal(result.offer.livingCost, 1, 0)}"></td></tr>
                        <tfoot><tr><td>Residual</td><td th:text="${'$' + #numbers.formatDecimal(result.offer.residual, 1, 0)}"></td></tr></tfoot>
                    </table>
                </div>
            </div>
        </details>

        <div class="section-title">Simulated living cost split</div>
        <div class="breakdown-grid">
            <div>
                <h3 th:text="${cityA.city} + ' essentials'">City A breakdown</h3>
                <table class="breakdown-table">
                    <tr><td>Groceries</td><td th:text="${'$' + #numbers.formatDecimal(result.current.groceries,1,0)}"></td></tr>
                    <tr><td>Transport</td><td th:text="${'$' + #numbers.formatDecimal(result.current.transport,1,0)}"></td></tr>
                    <tr><td>Utilities</td><td th:text="${'$' + #numbers.formatDecimal(result.current.utilities,1,0)}"></td></tr>
                    <tr><td>Misc</td><td th:text="${'$' + #numbers.formatDecimal(result.current.misc,1,0)}"></td></tr>
                    <tfoot><tr><td>Total living cost</td><td th:text="${'$' + #numbers.formatDecimal(result.current.livingCost,1,0)}"></td></tr></tfoot>
                </table>
            </div>
            <div>
                <h3 th:text="${cityB.city} + ' essentials'">City B breakdown</h3>
                <table class="breakdown-table">
                    <tr><td>Groceries</td><td th:text="${'$' + #numbers.formatDecimal(result.offer.groceries,1,0)}"></td></tr>
                    <tr><td>Transport</td><td th:text="${'$' + #numbers.formatDecimal(result.offer.transport,1,0)}"></td></tr>
                    <tr><td>Utilities</td><td th:text="${'$' + #numbers.formatDecimal(result.offer.utilities,1,0)}"></td></tr>
                    <tr><td>Misc</td><td th:text="${'$' + #numbers.formatDecimal(result.offer.misc,1,0)}"></td></tr>
                    <tfoot><tr><td>Total living cost</td><td th:text="${'$' + #numbers.formatDecimal(result.offer.livingCost,1,0)}"></td></tr></tfoot>
                </table>
            </div>
        </div>

        <div class="section-title" th:text="'Other ' + ${job.title} + ' salary comparisons'"></div>
        <ul class="related-list">
            <li th:each="link : ${otherJobLinks}">
                <a th:href="${link}" th:text="${link}"></a>
            </li>
        </ul>

        <div class="section-title" th:text="'Compare ' + ${cityA.city} + ' with other cities'"></div>
        <ul class="related-list">
            <li th:each="link : ${otherCityLinks}">
                <a th:href="${link}" th:text="${link}"></a>
            </li>
        </ul>

        <div id="bottomAdSlot"><!-- ADSENSE HERE --></div>
    </div>

    <div class="footer">
        Not financial or tax advice.
    </div>
</div>

<script type="application/ld+json" th:utext="${structuredDataJson}"></script>
<script>
    (function animateBars() {
        const bars = document.querySelectorAll('.bar-fill');
        bars.forEach(bar => {
            const width = bar.getAttribute('data-width');
            if (!width) return;
            requestAnimationFrame(() => {
                bar.style.width = width + '%';
            });
        });
    })();

    (function wireShare() {
        const shareButton = document.getElementById('shareButton');
        if (!shareButton) return;
        shareButton.addEventListener('click', async () => {
            const url = window.location.href;
            try {
                if (navigator.share) {
                    await navigator.share({ title: document.title, url });
                    return;
                }
                await navigator.clipboard.writeText(url);
                shareButton.textContent = 'Link copied!';
                setTimeout(() => shareButton.textContent = 'Share verdict', 1500);
            } catch (e) {
                shareButton.textContent = 'Unable to share';
                setTimeout(() => shareButton.textContent = 'Share verdict', 2000);
            }
        });
    })();
</script>
</body>
</html>
