<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">OfferVerdict</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="/css/dashboard.css">

    <!-- SEO -->
    <meta name="description" th:content="${metaDescription}">
    <link rel="canonical" th:href="${canonicalUrl}">

    <!-- Open Graph -->
    <meta property="og:title" th:content="${ogTitle}" />
    <meta property="og:description" th:content="${ogDescription}" />
    <meta property="og:image" th:content="${ogImageUrl}" />
</head>

<body class="theme-lucid">

    <nav class="top-nav">
        <div class="container">
            <a href="/" class="logo">OfferVerdict</a>
        </div>
    </nav>

    <main class="main-content">
        <!-- LAYER 1: VERDICT (The Hook) -->
        <section class="verdict-section" th:classappend="${result.verdict != null ? result.verdict.name() : 'NO_GO'}">
            <div class="container">
                <div class="verdict-header">
                    <span class="badge-source">DATA: IRS 2025 ‚Ä¢ NUMBEO ‚Ä¢ BLS</span>
                </div>

                <div class="verdict-display">
                    <h1 class="verdict-text animate-pop"
                        th:text="${result.verdictCopy != null ? result.verdictCopy : 'CALCULATING'}">DON'T GO</h1>
                    <div class="verdict-sub"
                        th:text="${result.valueDiffMsg != null ? result.valueDiffMsg : 'Analyzing your options...'}">You
                        get poorer.</div>

                    <!-- Negotiation Leverage -->
                    <div class="leverage-card"
                        th:if="${result.verdict != null and (result.verdict.name() == 'NO_GO' or result.verdict.name() == 'WARNING' or result.verdict.name() == 'CONDITIONAL')}">
                        <div class="leverage-icon">üí°</div>
                        <div class="leverage-content">
                            <span class="leverage-title">Agentic Negotiator</span>
                            <span class="leverage-msg"
                                th:text="${result.leverageMsg != null ? result.leverageMsg : 'Negotiate for better compensation to match your current lifestyle.'}">
                                Ask for $145,000 to match your current lifestyle.
                            </span>
                        </div>
                    </div>
                </div>

                <div class="financial-impact">
                    <div class="impact-label">Monthly Cash Flow Impact</div>
                    <div class="impact-value" th:text="${result.monthlyGainStr != null ? result.monthlyGainStr : '$0'}">
                        -$1,200</div>
                </div>
            </div>
        </section>

        <!-- LAYER 2: EVIDENCE (The Logic) -->
        <section class="evidence-section">
            <div class="container">
                <div class="section-title">
                    <h2>The Receipts</h2>
                    <p>Why we reached this verdict.</p>
                </div>

                <div class="receipt-grid">
                    <!-- City A -->
                    <div class="receipt-card">
                        <div class="card-header">
                            <h3 th:text="${cityA.city}">City A</h3>
                            <span class="badge">Current</span>
                        </div>
                        <div class="line-item">
                            <span class="label">Gross Salary</span>
                            <span class="value mono"
                                th:text="${'$' + #numbers.formatInteger(currentSalary, 0, 'COMMA')}">$100,000</span>
                        </div>
                        <div class="line-item danger-text">
                            <span class="label">Total Tax (Est.)</span>
                            <span class="value mono"
                                th:text="${'-$' + #numbers.formatInteger(result.current.taxResult.totalTax, 0, 'COMMA')}">-$24,000</span>
                        </div>
                        <div class="line-item warning-text">
                            <span class="label">Housing (Yearly)</span>
                            <span class="value mono"
                                th:text="${'-$' + #numbers.formatInteger(result.current.rent * 12, 0, 'COMMA')}">-$36,000</span>
                        </div>
                        <div class="line-item success-text highlight-row">
                            <span class="label">Residual (Cash)</span>
                            <span class="value mono"
                                th:text="${'$' + #numbers.formatInteger(result.current.residual * 12, 0, 'COMMA')}">$40,000</span>
                        </div>
                    </div>

                    <!-- City B -->
                    <div class="receipt-card">
                        <div class="card-header">
                            <h3 th:text="${cityB.city}">City B</h3>
                            <span class="badge brand">Offer</span>
                        </div>
                        <div class="line-item">
                            <span class="label">Gross Salary</span>
                            <span class="value mono"
                                th:text="${'$' + #numbers.formatInteger(offerSalary, 0, 'COMMA')}">$120,000</span>
                        </div>
                        <div class="line-item danger-text">
                            <span class="label">Total Tax (Est.)</span>
                            <span class="value mono"
                                th:text="${'-$' + #numbers.formatInteger(result.offer.taxResult.totalTax, 0, 'COMMA')}">-$32,000</span>
                        </div>
                        <div class="line-item warning-text">
                            <span class="label">Housing (Yearly)</span>
                            <span class="value mono"
                                th:text="${'-$' + #numbers.formatInteger(result.offer.rent * 12, 0, 'COMMA')}">-$48,000</span>
                        </div>
                        <div class="line-item success-text highlight-row">
                            <span class="label">Residual (Cash)</span>
                            <span class="value mono"
                                th:text="${'$' + #numbers.formatInteger(result.offer.residual * 12, 0, 'COMMA')}">$40,000</span>
                        </div>
                    </div>
                </div>

                <!-- Visual Bar for Tax/Rent Gap -->
                <div class="visual-gap">
                    <!-- Simple CSS bars could go here if needed, keeping it clean for now -->
                </div>
            </div>
        </section>

        <!-- LAYER 3: FEELING (The Experience/Reality) -->
        <section class="feeling-section">
            <div class="container">
                <div class="section-title">
                    <h2>Reality Check</h2>
                    <p>What this change actually feels like.</p>
                </div>

                <div class="reality-grid">
                    <!-- Tesla Index -->
                    <div class="reality-card">
                        <div class="icon">üöó</div>
                        <div class="reality-content">
                            <h4>Tesla Model 3 Index</h4>
                            <p>
                                In <span th:text="${cityA.city}">City A</span>, it takes <strong
                                    th:text="${#numbers.formatDecimal(result.current.monthsToBuyTesla, 1, 1)}">8.2</strong>
                                months of savings.
                                <br>
                                In <span th:text="${cityB.city}">City B</span>, it takes <strong
                                    th:text="${#numbers.formatDecimal(result.offer.monthsToBuyTesla, 1, 1)}">9.5</strong>
                                months.
                            </p>
                            <div class="mini-verdict"
                                th:if="${result.offer.monthsToBuyTesla < result.current.monthsToBuyTesla}">You get
                                wheels faster.</div>
                            <div class="mini-verdict negative"
                                th:if="${result.offer.monthsToBuyTesla >= result.current.monthsToBuyTesla}">You work
                                longer for the same car.</div>
                        </div>
                    </div>

                    <!-- House Index -->
                    <div class="reality-card">
                        <div class="icon">üè°</div>
                        <div class="reality-content">
                            <h4>The American Dream</h4>
                            <p>Years to save 20% down payment on average home.</p>
                            <div class="comparison-row">
                                <span th:text="${cityA.city}">City A</span>: <strong
                                    th:text="${#numbers.formatDecimal(result.current.yearsToBuyHouse, 1, 1) + ' Years'}">5.2
                                    Years</strong>
                            </div>
                            <div class="comparison-row">
                                <span th:text="${cityB.city}">City B</span>: <strong
                                    th:text="${#numbers.formatDecimal(result.offer.yearsToBuyHouse, 1, 1) + ' Years'}">7.4
                                    Years</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- LAYER 4: SIMULATOR (The Retention/Confidence) -->
        <section class="simulator-section" id="simulator">
            <div class="container">
                <div class="section-title">
                    <h2>Simulation Lab</h2>
                    <p>Personalize the data into conviction.</p>
                </div>

                <div class="simulator-box">
                    <form id="simulationForm" class="sim-grid">
                        <!-- Hidden Inputs -->
                        <input type="hidden" name="cityA" th:value="${cityA.slug}">
                        <input type="hidden" name="cityB" th:value="${cityB.slug}">
                        <input type="hidden" name="currentSalary" th:value="${currentSalary}">
                        <input type="hidden" name="offerSalary" th:value="${offerSalary}">

                        <!-- Controls -->
                        <div class="control-group">
                            <label>Filing Status</label>
                            <select name="isMarried" id="sim-married">
                                <option value="false" th:selected="${!effectiveIsMarried}">Single</option>
                                <option value="true" th:selected="${effectiveIsMarried}">Married (Joint)</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label>Housing Type</label>
                            <select name="housingType" id="sim-housing">
                                <option value="RENT">Renting</option>
                                <option value="OWN">Buying</option>
                                <option value="PARENTS">Living with Parents</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label>401k Contribution (%)</label>
                            <input type="number" name="fourOhOneKRate" value="0.05" step="0.01" min="0" max="0.30">
                        </div>

                        <div class="control-group">
                            <button type="button" id="btn-recalc" class="btn-simulate">Run Simulation</button>
                        </div>
                    </form>

                    <div id="sim-result-preview" class="sim-preview hidden">
                        <!-- Dynamic JS result will populate here -->
                        Updating verdict...
                    </div>
                </div>
            </div>
        </section>

        <footer class="footer">
            <div class="container">
                <p>&copy; 2026 OfferVerdict. Built on Truth.</p>
            </div>
        </footer>
    </main>

    <script src="/js/dashboard.js"></script>
</body>

</html>